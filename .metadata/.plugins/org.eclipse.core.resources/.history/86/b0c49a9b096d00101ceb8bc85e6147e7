package testCases;

import org.testng.annotations.Factory;
import utilities.ExcelUtility;

public class TestFactory {

    @Factory
    public Object[] createTests() throws Exception {
        String path = System.getProperty("user.dir") + "/testdata/Test1.xlsx";
        String sheet = "Sheet1";

        // Load workbook once
        ExcelUtility.setExcelPath(path);

        int rowCount = ExcelUtility.getRowCount(sheet);
        System.out.println("ðŸ“„ Total rows (including header): " + rowCount);

        // Adjust for skipping the header (row 0)
        Object[] tests = new Object[rowCount - 1];

        for (int i = 1; i < rowCount; i++) {
            String email = ExcelUtility.getCellData(sheet, i, 0);
            String password = ExcelUtility.getCellData(sheet, i, 1);
            String auditName = ExcelUtility.getCellData(sheet, i, 2);
            String startMM = ExcelUtility.getCellData(sheet, i, 3);
            String startDD = ExcelUtility.getCellData(sheet, i, 4);
            String startYYYY = ExcelUtility.getCellData(sheet, i, 5);
            String endMM = ExcelUtility.getCellData(sheet, i, 6);
            String endDD = ExcelUtility.getCellData(sheet, i, 7);
            String endYYYY = ExcelUtility.getCellData(sheet, i, 8);
            String auditor = ExcelUtility.getCellData(sheet, i, 9);
            String stakeholder = ExcelUtility.getCellData(sheet, i, 10);
            String organisation = ExcelUtility.getCellData(sheet, i, 11);

            System.out.println("âœ… Loading test data from row " + i + ": " + email);

            tests[i - 1] = new FullAuditFlowSplit(
                    email, password, auditName,
                    startMM, startDD, startYYYY,
                    endMM, endDD, endYYYY,
                    auditor, stakeholder, organisation
            );
        }

        // Close the Excel workbook
        ExcelUtility.closeWorkbook();

        return tests;
    }
}
